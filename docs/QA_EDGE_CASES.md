# Saantey POS v2 - QA Edge Cases & Failure Scenarios

**Generated by:** Replit Design Agent  
**Date:** January 24, 2026  
**Scope:** Purchasing, Inventory, Waste, and Cross-Cutting Modules  

---

## 1. Purchasing Module (20 Cases)

### 1.1 Create PO - Inactive Vendor
- **Module/Route:** Purchasing / Create PO / `/purchasing/orders/new`
- **Category:** Data Integrity / Business Logic
- **Preconditions:** Vendor "Sysco" exists but status is `Excluded`.
- **Steps:** User attempts to create a new PO and searches for "Sysco" in the vendor dropdown.
- **Expected UI Behavior:** "Sysco" should either not appear or appear disabled/grayed out with an "Excluded" badge.
- **Expected API Behavior:** API should reject `POST /orders` with `400 Bad Request` if `vendor_id` corresponds to an excluded vendor.
- **Severity:** S2
- **Test Type:** Integration

### 1.2 PO Line Item - Zero Quantity
- **Module/Route:** Purchasing / Order Detail / `/purchasing/orders/:id`
- **Category:** Validation
- **Steps:** User enters `0` in the quantity field for a line item and attempts to save.
- **Expected UI Behavior:** Input field shows validation error ("Qty must be > 0"). Save button disabled or shows error toast on click.
- **Severity:** S3
- **Test Type:** Unit

### 1.3 PO Line Item - Negative Quantity
- **Module/Route:** Purchasing / Order Detail / `/purchasing/orders/:id`
- **Category:** Validation
- **Steps:** User enters `-5` in the quantity field.
- **Expected UI Behavior:** Validation error. Negative values blocked for standard POs.
- **Severity:** S3
- **Test Type:** Unit

### 1.4 PO Line Item - Large Quantity (Overflow)
- **Module/Route:** Purchasing / Order Detail / `/purchasing/orders/:id`
- **Category:** Data Integrity
- **Steps:** User enters `999,999,999` or larger integer.
- **Expected UI Behavior:** Warning "Quantity unusually high". System handles value without crashing.
- **Severity:** S3
- **Test Type:** Boundary

### 1.5 Duplicate Item in PO
- **Module/Route:** Purchasing / Order Detail / `/purchasing/orders/:id`
- **Category:** UX / Data Integrity
- **Steps:** Add "Whole Milk" to PO. Add "Whole Milk" again as a second line.
- **Expected UI Behavior:** UI should merge lines (increment qty) OR alert user "Item already exists".
- **Severity:** S3
- **Test Type:** UX

### 1.6 Delete Item from Sent PO
- **Module/Route:** Purchasing / Order Detail / `/purchasing/orders/:id`
- **Category:** State Machine
- **Preconditions:** PO status is `Sent`.
- **Steps:** User tries to delete a line item.
- **Expected UI Behavior:** Delete action disabled or hidden. "Cannot edit Sent PO".
- **Severity:** S2
- **Test Type:** Functional

### 1.7 Price Change in Master Data
- **Module/Route:** Purchasing / Order Detail / `/purchasing/orders/:id`
- **Category:** Data Integrity
- **Preconditions:** PO created with Item A @ $10. Admin changes Item A cost to $12.
- **Steps:** Open old PO.
- **Expected UI Behavior:** PO should retain the historical cost ($10) captured at creation/send time. Should NOT auto-update.
- **Expected DB Outcome:** `order_items.unit_cost` remains unchanged.
- **Severity:** S2
- **Test Type:** Integration

### 1.8 Delivery Date in Past
- **Module/Route:** Purchasing / Create PO / `/purchasing/orders/new`
- **Category:** Validation
- **Steps:** Select delivery date = Yesterday.
- **Expected UI Behavior:** Warning "Date is in the past". Soft block (confirmation required) or hard block depending on policy.
- **Severity:** S3
- **Test Type:** Unit

### 1.9 Delivery Date Too Far Future
- **Module/Route:** Purchasing / Create PO / `/purchasing/orders/new`
- **Category:** Business Logic
- **Steps:** Select delivery date = 2 years from now.
- **Expected UI Behavior:** Warning "Check delivery date".
- **Severity:** S3
- **Test Type:** Unit

### 1.10 Missing Vendor Contact Email
- **Module/Route:** Purchasing / Order Detail / `/purchasing/orders/:id`
- **Category:** Validation / UX
- **Steps:** Click "Send PO". Vendor has no email configured.
- **Expected UI Behavior:** Modal alert: "Vendor has no email. Download PDF instead?". Transition to `Sent` only after manual confirmation.
- **Severity:** S2
- **Test Type:** Functional

### 1.11 Concurrent Status Change
- **Module/Route:** Purchasing / Order Detail
- **Category:** Concurrency
- **Preconditions:** User A and User B viewing same Draft PO.
- **Steps:** User A deletes PO. User B tries to "Send" PO.
- **Expected API Behavior:** User B request fails `404 Not Found` or `409 Conflict`.
- **Expected UI Behavior:** User B sees "Order no longer exists" or "Status changed".
- **Severity:** S2
- **Test Type:** Integration

### 1.12 Receive - Quantity > Ordered
- **Module/Route:** Receive PO / `/purchasing/orders/:id/receive`
- **Category:** Business Logic
- **Steps:** Ordered 10. User enters Received 15.
- **Expected UI Behavior:** Warning highlight (Yellow/Orange). "Received > Ordered". Allowed to proceed with reason.
- **Severity:** S3
- **Test Type:** Functional

### 1.13 Receive - Partial Receipt
- **Module/Route:** Receive PO / `/purchasing/orders/:id/receive`
- **Category:** State Machine
- **Steps:** Ordered 10. User enters Received 5. Finalize receiving.
- **Expected UI Behavior:** PO status becomes `Partially Received`. Remaining 5 stay on Open PO (or create backorder).
- **Severity:** S2
- **Test Type:** Functional

### 1.14 Vendor Search Special Characters
- **Module/Route:** Purchasing / Vendor List / `/purchasing/vendors`
- **Category:** Security / UX
- **Steps:** Search for "O'Reilly", "Caf√©", "<script>".
- **Expected UI Behavior:** Handles characters correctly. No XSS execution. Finds "O'Reilly".
- **Severity:** S2
- **Test Type:** Security

### 1.15 Filter Date Range Inverted
- **Module/Route:** Purchasing / Order List
- **Category:** UX
- **Steps:** Set Start Date = Dec 31, End Date = Jan 1.
- **Expected UI Behavior:** Auto-swap dates OR show validation error "Start date must be before end date".
- **Severity:** S3
- **Test Type:** Unit

### 1.16 Pagination Out of Range
- **Module/Route:** Purchasing / Order List
- **Category:** UX
- **Steps:** Manually edit URL query param `?page=9999`.
- **Expected UI Behavior:** Show empty state or redirect to last valid page. No crash.
- **Severity:** S3
- **Test Type:** Functional

### 1.17 Network Fail on Save
- **Module/Route:** Purchasing / Order Detail
- **Category:** UX / Resilience
- **Steps:** Edit PO. Disconnect network. Click Save.
- **Expected UI Behavior:** "Network error. Retrying..." or "Failed to save". Data remains in form (not lost).
- **Severity:** S2
- **Test Type:** E2E

### 1.18 SQL Injection in Search
- **Module/Route:** Purchasing / Order List
- **Category:** Security
- **Steps:** Input `' OR '1'='1` in search bar.
- **Expected API Behavior:** Sanitized query. Returns 0 results (or literal match).
- **Severity:** S1
- **Test Type:** Security

### 1.19 UOM Mismatch on Receive
- **Module/Route:** Receive PO
- **Category:** Data Integrity
- **Preconditions:** Item ordered in Cases. Inventory tracks in Each.
- **Steps:** Receive screen shows conversion (e.g., 1 Case = 12 Each). User edits conversion factor.
- **Expected UI Behavior:** Locked if fixed conversion, or clearly labeled if variable. Warning if outside tolerance.
- **Severity:** S2
- **Test Type:** Functional

### 1.20 Export Empty List
- **Module/Route:** Purchasing / Order List
- **Category:** Reporting
- **Steps:** Filter to zero results. Click Export CSV.
- **Expected UI Behavior:** "No data to export" toast. Or export headers only.
- **Severity:** S3
- **Test Type:** Functional

---

## 2. Invoices Module (20 Cases)

### 2.1 Duplicate Invoice ID (Same Vendor)
- **Module/Route:** Invoice Detail / `/purchasing/invoices/:id`
- **Category:** Data Integrity
- **Steps:** Create invoice with ID "INV-123" for Vendor A. Try to create another "INV-123" for Vendor A.
- **Expected API Behavior:** `409 Conflict`. "Invoice number already exists for this vendor".
- **Severity:** S2
- **Test Type:** Integration

### 2.2 Duplicate Invoice ID (Different Vendor)
- **Module/Route:** Invoice Detail
- **Category:** Data Integrity
- **Steps:** Create invoice "INV-123" for Vendor B.
- **Expected API Behavior:** `200 OK`. Duplicates allowed across different vendors.
- **Severity:** S2
- **Test Type:** Integration

### 2.3 Invoice Date in Future
- **Module/Route:** Invoice Detail
- **Category:** Validation
- **Steps:** Set Invoice Date = Tomorrow.
- **Expected UI Behavior:** Warning "Invoice date is in the future". (Some vendors post-date, so maybe allow with warning).
- **Severity:** S3
- **Test Type:** Functional

### 2.4 Finalize with Zero Total
- **Module/Route:** Invoice Detail
- **Category:** Business Logic
- **Steps:** Create invoice with items totaling $0.00. Click Finalize.
- **Expected UI Behavior:** "Cannot finalize zero-amount invoice" (unless free sample workflow). Warning required.
- **Severity:** S2
- **Test Type:** Functional

### 2.5 Header/Line Total Mismatch
- **Module/Route:** Invoice Detail
- **Category:** Data Integrity
- **Steps:** Manually enter Invoice Total = $100. Line items sum = $90.
- **Expected UI Behavior:** "Totals do not match ($10 discrepancy)". Block Finalize or require "Misc Charge" entry to balance.
- **Severity:** S2
- **Test Type:** Functional

### 2.6 Reject Finalized Invoice
- **Module/Route:** Invoice Detail
- **Category:** State Machine
- **Preconditions:** Status = `Finalized`.
- **Steps:** User tries to find Reject button.
- **Expected UI Behavior:** Reject action hidden/disabled. Must use "Credit Memo" or "Void" (if allowed by role).
- **Severity:** S1
- **Test Type:** Functional

### 2.7 Edit Finalized Invoice
- **Module/Route:** Invoice Detail
- **Category:** Data Integrity / Immutability
- **Preconditions:** Status = `Finalized`.
- **Steps:** User attempts to POST update to line items via API (bypassing UI).
- **Expected API Behavior:** `403 Forbidden` or `422 Unprocessable Entity`. Entity is locked.
- **Severity:** S1
- **Test Type:** Security/Integration

### 2.8 Credit Memo > Invoice Value
- **Module/Route:** Invoice Detail / Credit Memo
- **Category:** Business Logic
- **Steps:** Invoice total $100. Create Credit Memo for $150.
- **Expected UI Behavior:** Warning/Block. Credit cannot exceed original invoice value (usually).
- **Severity:** S2
- **Test Type:** Functional

### 2.9 Import Duplicates
- **Module/Route:** Invoice List / Import
- **Category:** Import
- **Steps:** Upload CSV with invoice ID that already exists.
- **Expected UI Behavior:** Skip existing or prompt "Update or Skip?". Report shows "1 Duplicate Skipped".
- **Severity:** S3
- **Test Type:** Functional

### 2.10 Malformed Import File
- **Module/Route:** Invoice List / Import
- **Category:** Import
- **Steps:** Upload .txt file renamed as .csv, or CSV with missing columns.
- **Expected UI Behavior:** "Invalid file format" or "Column 'Vendor' missing". No crash.
- **Severity:** S2
- **Test Type:** Functional

### 2.11 Import Vendor Mismatch
- **Module/Route:** Invoice List / Import
- **Category:** Import
- **Steps:** CSV contains Vendor Name "Unknown Supply Co".
- **Expected UI Behavior:** Validation error. "Vendor not found". Allow mapping to existing vendor or creating new.
- **Severity:** S2
- **Test Type:** Functional

### 2.12 Concurrent Finalize
- **Module/Route:** Invoice Detail
- **Category:** Concurrency
- **Steps:** User A and B both click "Finalize" at the exact same millisecond.
- **Expected API Behavior:** Idempotency key or transaction lock. Only one succeeds, or second one returns "Already finalized". No double accounting.
- **Severity:** S1
- **Test Type:** Load/Integration

### 2.13 Permission Denied Finalize
- **Module/Route:** Invoice Detail
- **Category:** RBAC
- **Preconditions:** User has `Viewer` role.
- **Steps:** Tries to click Finalize.
- **Expected UI Behavior:** Button disabled/hidden.
- **API Check:** POST returns `403 Forbidden`.
- **Severity:** S1
- **Test Type:** Security

### 2.14 Rounding Errors (3 decimals)
- **Module/Route:** Invoice Detail
- **Category:** Calculation
- **Steps:** Item price $1.333. Qty 3.
- **Expected Behavior:** Line total $4.00 (1.333 * 3 = 3.999 -> 4.00) vs $3.99. System must define consistent rounding rule (e.g., round half up at line level).
- **Severity:** S2
- **Test Type:** Unit

### 2.15 Tax Calculation Mismatch
- **Module/Route:** Invoice Detail
- **Category:** Validation
- **Steps:** Auto-calculated tax = $10. User manually edits invoice tax to $50 (huge variance).
- **Expected UI Behavior:** Warning "Tax variance high".
- **Severity:** S3
- **Test Type:** Functional

### 2.16 Delete Pending Invoice
- **Module/Route:** Invoice Detail
- **Category:** State Machine
- **Steps:** Delete invoice in `Pending` state.
- **Expected Behavior:** Allowed. Soft delete in DB. Audit log entry created.
- **Severity:** S2
- **Test Type:** Functional

### 2.17 Reactivate Rejected Invoice
- **Module/Route:** Invoice Detail
- **Category:** State Machine
- **Steps:** Open `Rejected` invoice. Click "Reopen/Draft".
- **Expected Behavior:** Allowed (resets status to Draft). Audit log entry.
- **Severity:** S3
- **Test Type:** Functional

### 2.18 Large Invoice (500+ lines)
- **Module/Route:** Invoice Detail
- **Category:** Performance
- **Steps:** Load invoice with 500 lines.
- **Expected UI Behavior:** Render time < 2s. Virtualized list if needed. No browser freeze.
- **Severity:** S3
- **Test Type:** Performance

### 2.19 Negative Invoice Total (Not Credit Memo)
- **Module/Route:** Invoice Detail
- **Category:** Data Integrity
- **Steps:** Enter items resulting in negative total.
- **Expected UI Behavior:** "Negative total. Please use Credit Memo module."
- **Severity:** S2
- **Test Type:** Functional

### 2.20 Orphaned Line Items
- **Module/Route:** Invoice Detail
- **Category:** Data Integrity
- **Steps:** Delete Invoice Header via API. Check Line Items table.
- **Expected DB Outcome:** Cascade delete or soft delete lines. No orphans.
- **Severity:** S1
- **Test Type:** Integration

---

## 3. Inventory Posting & Count (20 Cases)

### 3.1 Daily Count - Missing Item
- **Module/Route:** Count Entry / `/inventory/posting/:id`
- **Category:** UX
- **Steps:** "Avocados" missing from Daily Count sheet.
- **Expected UI Behavior:** "Add Item" button available. Search and append item to count batch.
- **Severity:** S3
- **Test Type:** Functional

### 3.2 Non-Numeric Count Input
- **Module/Route:** Count Entry
- **Category:** Validation
- **Steps:** Type "abc" in count field.
- **Expected UI Behavior:** Input rejected or ignored. Only numbers allowed.
- **Severity:** S3
- **Test Type:** Unit

### 3.3 Negative Count
- **Module/Route:** Count Entry
- **Category:** Data Integrity
- **Steps:** Enter "-5" quantity.
- **Expected UI Behavior:** Blocked. Physical count cannot be negative.
- **Severity:** S2
- **Test Type:** Unit

### 3.4 Huge Count Value
- **Module/Route:** Count Entry
- **Category:** Validation
- **Steps:** Enter "10,000" for an item normally "10".
- **Expected UI Behavior:** Warning "High variance". Confirm required.
- **Severity:** S2
- **Test Type:** Functional

### 3.5 Submit Empty Batch
- **Module/Route:** Count Entry
- **Category:** UX
- **Steps:** Create batch. Enter nothing. Click Submit.
- **Expected UI Behavior:** "No items counted. Submit anyway?" (Treats as zero or ignore?) Clearly defined behavior required (usually block empty).
- **Severity:** S3
- **Test Type:** Functional

### 3.6 Submit with Uncounted Items
- **Module/Route:** Count Entry
- **Category:** Business Logic
- **Steps:** Batch has 100 items. User counts 90. 10 left blank.
- **Expected UI Behavior:** Warning: "10 items not counted. These will be recorded as 0."
- **Severity:** S2
- **Test Type:** Functional

### 3.7 Concurrent Count Entry (Collision)
- **Module/Route:** Count Entry
- **Category:** Concurrency
- **Steps:** User A enters "5" for Milk. User B enters "10" for Milk. Both auto-save.
- **Expected UI Behavior:** Last write wins (typically) OR "Someone else updated this field". WebSockets preferred for real-time.
- **Severity:** S2
- **Test Type:** Integration

### 3.8 Edit Submitted Batch
- **Module/Route:** Count Entry
- **Category:** Immutability
- **Preconditions:** Batch Status = `Posted`.
- **Steps:** User tries to change count.
- **Expected Behavior:** Read-only view. "Batch finalized". Must create Adjustment to fix errors.
- **Severity:** S1
- **Test Type:** Functional

### 3.9 Future Date Count
- **Module/Route:** Inventory Posting Wizard
- **Category:** Business Logic
- **Steps:** Select "Date of Count" = Next Week.
- **Expected UI Behavior:** Warning/Block. Counts are usually retrospective or real-time.
- **Severity:** S3
- **Test Type:** Functional

### 3.10 Location Switch During Count
- **Module/Route:** Count Entry
- **Category:** UX / Data Integrity
- **Steps:** User counting "Downtown". Swaps location to "Westside" via header.
- **Expected UI Behavior:** "Unsaved changes" prompt. Do not mix data. Redirect to Westside dashboard or new count sheet.
- **Severity:** S2
- **Test Type:** UX

### 3.11 Autosave Offline
- **Module/Route:** Count Entry
- **Category:** Resilience
- **Steps:** Go offline. Enter counts.
- **Expected UI Behavior:** "Offline - Saving locally". Sync when back online. Do not lose data on refresh.
- **Severity:** S2
- **Test Type:** E2E

### 3.12 Tab Navigation Focus Trap
- **Module/Route:** Count Entry
- **Category:** Accessibility
- **Steps:** User tabs through grid. Focus gets stuck or jumps to header.
- **Expected UI Behavior:** Focus moves smoothly cell to cell.
- **Severity:** S2
- **Test Type:** Accessibility

### 3.13 Inactive Item in Count
- **Module/Route:** Count Entry
- **Category:** Data Integrity
- **Steps:** Item made Inactive yesterday.
- **Expected Behavior:** Should NOT appear on new count sheets. Should appear if it has non-zero stock (to count down to 0).
- **Severity:** S3
- **Test Type:** Functional

### 3.14 UOM Conversion Change
- **Module/Route:** Count Entry
- **Category:** Data Integrity
- **Steps:** Item UOM changed from LB to KG mid-count.
- **Expected Behavior:** Batch locks snapshot of UOM at creation time.
- **Severity:** S2
- **Test Type:** Integration

### 3.15 Large Batch Performance
- **Module/Route:** Count Entry
- **Category:** Performance
- **Steps:** Batch with 2000 items.
- **Expected UI Behavior:** Scroll performance 60fps. Input lag < 50ms.
- **Severity:** S2
- **Test Type:** Performance

### 3.16 Delete Active Batch
- **Module/Route:** Inventory Home
- **Category:** State Machine
- **Steps:** Delete `In Progress` batch.
- **Expected Behavior:** Allowed. Confirmation required.
- **Severity:** S3
- **Test Type:** Functional

### 3.17 Zero Cost Item Value
- **Module/Route:** Inventory Value Report
- **Category:** Reporting
- **Steps:** Item counted (Qty 10) but has $0 cost.
- **Expected Behavior:** Value = $0. Warning "Missing cost for items".
- **Severity:** S3
- **Test Type:** Functional

### 3.18 Duplicate Batch (Same Period)
- **Module/Route:** Inventory Posting
- **Category:** Business Logic
- **Steps:** Create Daily Count for 1/24. Create another Daily Count for 1/24.
- **Expected UI Behavior:** Warning "Batch already exists for this date/location. Resume?"
- **Severity:** S3
- **Test Type:** Functional

### 3.19 Keyboard Entry Latency
- **Module/Route:** Count Entry
- **Category:** UX
- **Steps:** Rapidly type "1 [Down] 2 [Down] 3".
- **Expected UI Behavior:** No missed keystrokes.
- **Severity:** S2
- **Test Type:** Performance

### 3.20 Submit without Permissions
- **Module/Route:** Count Entry
- **Category:** RBAC
- **Steps:** Counter role tries to Submit (only Manager can submit).
- **Expected UI Behavior:** "Submit" button replaced with "Complete for Review".
- **Severity:** S2
- **Test Type:** Security

---

## 4. Waste Module (15 Cases)

### 4.1 Waste Qty > On Hand
- **Module/Route:** Waste Entry / `/inventory/waste`
- **Category:** Business Logic
- **Steps:** On hand 5. Waste 10.
- **Expected UI Behavior:** Warning "Waste exceeds stock". Allow (stock can be wrong), but flag.
- **Severity:** S3
- **Test Type:** Functional

### 4.2 Negative Waste Qty
- **Module/Route:** Waste Entry
- **Category:** Validation
- **Steps:** Enter -5.
- **Expected UI Behavior:** Block. Cannot waste negative. (Use Adjustment for found stock).
- **Severity:** S2
- **Test Type:** Unit

### 4.3 Missing Reason Code
- **Module/Route:** Waste Entry
- **Category:** Validation
- **Steps:** Leave Reason blank.
- **Expected UI Behavior:** Block submit. "Reason required".
- **Severity:** S3
- **Test Type:** Unit

### 4.4 Backdated Waste (Closed Period)
- **Module/Route:** Waste Entry
- **Category:** Financial Integrity
- **Steps:** Date = Last Month (Closed).
- **Expected UI Behavior:** Block. "Period closed. Post to current date?".
- **Severity:** S1
- **Test Type:** Functional

### 4.5 Future Date Waste
- **Module/Route:** Waste Entry
- **Category:** Validation
- **Steps:** Date = Tomorrow.
- **Expected UI Behavior:** Block.
- **Severity:** S3
- **Test Type:** Unit

### 4.6 Waste Inactive Item
- **Module/Route:** Waste Entry
- **Category:** Data Integrity
- **Steps:** Search for Inactive item.
- **Expected UI Behavior:** Hidden by default. Toggle "Show Inactive" to find it (might need to waste old stock).
- **Severity:** S3
- **Test Type:** Functional

### 4.7 Bulk Waste Limit
- **Module/Route:** Waste Entry
- **Category:** Performance / Logic
- **Steps:** Import 1000 waste lines.
- **Expected UI Behavior:** Handle gracefully or limit batch size.
- **Severity:** S3
- **Test Type:** Load

### 4.8 Waste Cost Calculation (Missing)
- **Module/Route:** Waste Log
- **Category:** Reporting
- **Preconditions:** Item has no cost.
- **Steps:** Post waste.
- **Expected DB Outcome:** Logged Qty. Cost = 0. Flagged for review.
- **Severity:** S3
- **Test Type:** Integration

### 4.9 Duplicate Entry (Double Click)
- **Module/Route:** Waste Entry
- **Category:** UX
- **Steps:** Double click "Add Waste".
- **Expected UI Behavior:** Debounce button. Only 1 entry created.
- **Severity:** S2
- **Test Type:** UX

### 4.10 Permission Denied
- **Module/Route:** Waste Entry
- **Category:** RBAC
- **Steps:** Viewer role tries to access `/inventory/waste`.
- **Expected UI Behavior:** Redirect `403` or Read Only log view.
- **Severity:** S2
- **Test Type:** Security

### 4.11 No UOM Selected
- **Module/Route:** Waste Entry
- **Category:** Validation
- **Steps:** Item has multiple UOMs. None selected.
- **Expected UI Behavior:** Default to base UOM or block.
- **Severity:** S3
- **Test Type:** Unit

### 4.12 Waste Log Search SQLi
- **Module/Route:** Waste Log
- **Category:** Security
- **Steps:** Search reason: `'; DROP TABLE waste; --`
- **Expected Behavior:** Sanitized. No data loss.
- **Severity:** S1
- **Test Type:** Security

### 4.13 Edit Locked Waste Entry
- **Module/Route:** Waste Log
- **Category:** Immutability
- **Preconditions:** Waste batch finalized/posted to ledger.
- **Steps:** Edit qty.
- **Expected Behavior:** Blocked. Must void/reverse entry.
- **Severity:** S1
- **Test Type:** Functional

### 4.14 Zero Waste Qty
- **Module/Route:** Waste Entry
- **Category:** Validation
- **Steps:** Qty 0.
- **Expected Behavior:** Block. "Quantity required".
- **Severity:** S3
- **Test Type:** Unit

### 4.15 Very Long Reason Note
- **Module/Route:** Waste Entry
- **Category:** Validation
- **Steps:** Paste 5000 chars into Note.
- **Expected Behavior:** Truncate or max-length validation.
- **Severity:** S3
- **Test Type:** Unit

---

## 5. Cross-Cutting & System (10 Cases)

### 5.1 RBAC - Viewer POST Attempt
- **Module/Route:** API
- **Category:** Security
- **Steps:** Authenticated User with `Viewer` role sends `POST /api/invoices`.
- **Expected API Behavior:** `403 Forbidden`.
- **Severity:** S1
- **Test Type:** Security

### 5.2 Manager Admin Route Access
- **Module/Route:** Settings
- **Category:** Security
- **Steps:** Manager tries to access `/settings/users` (Admin only).
- **Expected UI Behavior:** Redirect to Dashboard or 403 Page.
- **Severity:** S2
- **Test Type:** Security

### 5.3 Cross-Location Data Access (IDOR)
- **Module/Route:** API
- **Category:** Security
- **Steps:** User logged in to Location A tries to GET `/api/orders/:id_of_loc_B`.
- **Expected API Behavior:** `403 Forbidden` or `404 Not Found`. Data scoping validation failure.
- **Severity:** S1
- **Test Type:** Security

### 5.4 Switch Location - Unsaved Changes
- **Module/Route:** Global Shell
- **Category:** UX
- **Steps:** Edit Invoice. Click Location Switcher in header.
- **Expected UI Behavior:** Modal: "Unsaved changes will be lost. Continue?".
- **Severity:** S2
- **Test Type:** UX

### 5.5 Timezone Mismatch
- **Module/Route:** General
- **Category:** Time/Date
- **Steps:** Server in UTC. Client in EST. Transaction at 11PM EST (Next day UTC).
- **Expected Behavior:** Dates displayed in Location Local Time. Ledger records consistent UTC.
- **Severity:** S2
- **Test Type:** Integration

### 5.6 Audit Log Missing
- **Module/Route:** General
- **Category:** Audit
- **Steps:** Finalize Invoice. Check Audit Log.
- **Expected Behavior:** "User X finalized Invoice Y at Time Z" entry exists.
- **Severity:** S1
- **Test Type:** Integration

### 5.7 CSRF Token Expiry
- **Module/Route:** Forms
- **Category:** Security
- **Steps:** Open form. Wait 24 hours. Click Submit.
- **Expected Behavior:** "Session expired. Please login." Redirect to login.
- **Severity:** S2
- **Test Type:** Security

### 5.8 API Rate Limiting
- **Module/Route:** API
- **Category:** Security
- **Steps:** Script sends 1000 search requests in 1 second.
- **Expected API Behavior:** `429 Too Many Requests`.
- **Severity:** S2
- **Test Type:** Load

### 5.9 PII Exposure
- **Module/Route:** Vendor API
- **Category:** Privacy
- **Steps:** Inspect API response for Vendor list.
- **Expected Behavior:** Returns business contact info ONLY. No personal home addresses/SSNs (if stored).
- **Severity:** S2
- **Test Type:** Security

### 5.10 Browser Back Button
- **Module/Route:** General
- **Category:** UX
- **Steps:** Finalize Invoice. Press Browser Back.
- **Expected UI Behavior:** Show Invoice in Finalized state (not editable form).
- **Severity:** S3
- **Test Type:** Functional
